<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<!--script type="text/javascript" src="jquery-1.4.2.min.js"></script-->
<script src="jquery-ui-1.8.13.custom/js/jquery-1.5.1.min.js"></script> 
<script src="jquery-ui-1.8.13.custom/js/jquery-ui-1.8.13.custom.min.js"></script> 
<script type="text/javascript" src="utils.js"></script>
<script type="text/javascript" src="apollo.js"></script>
<script type="text/javascript" src="arena.js"></script>
<link rel='stylesheet' href='arena.css' type='text/css' media='all' />

<script type="text/javascript">
function Eval(sText) { eval(sText); }

function ReceiveMessage(sMsg)
{
  return api.OnReceiveMessage(sMsg);
}

function DispatchMessage(msg)
{
  var sMethod = msg.getString('Method');
  switch (sMethod) {
    case 'AddAvatar': return arena.AddAvatar(msg.getString('hParticipant'), msg.getInt('bSelf'), msg.getInt('nX')); break;
    case 'RemoveAvatar': return arena.RemoveAvatar(msg.getString('hParticipant')); break;
    case 'ShowAvatar': return arena.ShowAvatar(msg.getString('hParticipant')); break;
    case 'HideAvatar': return arena.HideAvatar(msg.getString('hParticipant')); break;

    case 'SetAvatarPosition': return arena.SetAvatarPosition(msg.getString('hParticipant'), msg.getInt('nX')); break;
    case 'MoveAvatarPosition': return arena.MoveAvatarPosition(msg.getString('hParticipant'), msg.getInt('nX'), msg.getInt('nSpeedX')); break;
    case 'SetAvatarNickname': return arena.SetAvatarNickname(msg.getString('hParticipant'), msg.getString('sNickname')); break;
    case 'SetAvatarImage': return arena.SetAvatarImage(msg.getString('hParticipant'), msg.getString('sUrl')); break;
    case 'SetCommunityAttachment': return arena.SetCommunityAttachment(msg.getString('hParticipant'), msg.getString('sUrl'), msg.getString('sLabel'), msg.getString('sLink')); break;
    case 'SetIconAttachment': return arena.SetIconAttachment(msg.getString('hParticipant'), msg.getString('sUrl'), msg.getString('sLabel')); break;
    case 'SetOnlineStatus': return arena.SetOnlineStatus(msg.getString('hParticipant'), msg.getString('sStatus')); break;
    case 'AddAvatarChat': return arena.AddAvatarChat(msg.getString('hParticipant'), msg.getString('hChat'), msg.getString('sText')); break;
    case 'SetAvatarChat': return arena.SetAvatarChat(msg.getString('hParticipant'), msg.getString('hChat'), msg.getString('sText')); break;
    case 'RemoveAvatarChat': return arena.RemoveAvatarChat(msg.getString('hParticipant'), msg.getString('hChat')); break;

    case 'SetDocumentUrl': return arena.SetDocumentUrl(msg.getString('sUrl')); break;
    case 'SetLocationUrl': return arena.SetLocationUrl(msg.getString('sUrl')); break;
    case 'SetLocationState': return arena.SetLocationState(msg.getString('sState')); break;

    default: throw 'Unknown method: ' + sMethod;
  }
}

function RunUnittest()
{
    var t = new Unittest();
    t.Add('Unittest.SuccessTest', Unittest.SuccessTest);
    //t.Add('Unittest.FailedTest', Unittest.FailedTest);
    //t.Add('Unittest.ExceptionTest', Unittest.ExceptionTest);
    t.Add('Observable Basic', Observable_Tester.Basic);
    t.Add('Observable Remove', Observable_Tester.Remove);
    t.Add('Observable Serialize', Observable_Tester.Serialize);
    t.Add('String.toDomCompatible', String_Tester.toDomCompatible);

    t.Run();
}

  var api = new ApolloApi();
  api.moduleName = 'Arena';
  api.OnDispatchMessage = DispatchMessage;
  api.Init();

  var logger = Log.GetInstance('iOut', 'iLogCheck');
  Log.instance.SetLevel(Log.Level.VERBOSE);
  Log.instance.Clear();

  ApMessage.prototype.onLog = Log.IO;

  $(document).ready(
    function () {
      arena = new Arena('iContent');
      arena.Startup();
      
      //TranslateAll();
    }
  );
</script>

<style type="text/css">
#iWrapper { position:absolute; left:0px; top:0px; width:100%; height:100%; -webkit-box-shadow:inset 0 0 1px 1px #000000; }
#iContent { position:absolute; left:0px; top:0px; width:40%; height:100%; overflow:hidden; }
#iControl { background-color:rgba(255,255,204,0.7); }
#iControl * { font-family:Verdana; font-size:11px; }
#iOut { background-color:rgba(240,240,240,0.9); }
#iOut p { font-family:Lucida Console; font-size:10px; }
</style>

</head>
<body style="overflow:hidden;">
<div id="iWrapper">

  <div id="iContent" class="cContent"></div>

  <div id="iControl" style="position:absolute; left:40%; top:0; width:10%; height:100%; overflow:auto;">
    <input type="button" value="WebView_Reload" onclick="api.Message('WebView_Reload').send();" />
    <input type="button" value="reload()" onclick="document.location.reload();" />
    <input type="button" value="Quit" onclick="api.Message('MainLoop_EndLoop').send();"/>
    <input type="button" value="Unittest" onclick="RunUnittest();"/>
    <input type="checkbox" id="iLogCheck" checked="checked"/><label for="iLogCheck">Logging</label>
    <input type="button" value="Clear" onclick="Log.instance.Clear();" />
    <input type="button" value="Translate" onclick="Log.Info(api.Translate('ParamTest', 'Click me!'));" />
    <input type="button" value="Connect" onclick="api.Message('Xmpp_Connect').send();" />
    <input type="button" value="Disconnect" onclick="api.Message('Xmpp_Disconnect').send();" />
  </div>

  <div id="iOut" style="position:absolute; left:50%; top:0; width:50%; height:100%; overflow:auto; white-space: nowrap;"></div>

</div>
</body>

<script type="text/javascript">

</script>

</html>
