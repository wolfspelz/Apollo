<html>
<head>
<script type="text/javascript">
  function setupBridge()
  {
    document.getElementById("iChild").contentWindow.parentSandboxBridge = bridge;
  }

  function loadFrame()
  {
    var sSrc = window.location.search;
    sSrc = unescape(sSrc.substr(1));
    document.getElementById("iChild").src = sSrc;
  }

  function onSendMessage(a)
  {
    var s = '';
    for (var i in a) {
      s += i + '=' + a[i] + '\n';
    }
    window.sendMessage(s);
  }

  function onRequestConfig(sModule, sKey, sRef)
  {
    window.requestConfig(sModule, sKey, sRef);
  }

  function onRecvMessage(s)
  {
    var childInterface = document.getElementById("iChild").contentWindow.childSandboxBridge;
    if (childInterface){ childInterface.recvMessage(s); }
  }

  function onRecvConfigResponse(sValue, sRef)
  {
    var childInterface = document.getElementById("iChild").contentWindow.childSandboxBridge;
    if (childInterface){ childInterface.recvConfigResponse(sValue, sRef); }
  }

  var bridge = {};
  bridge.testProperty = 'testProperty';
  bridge.testFunction = function() { return 'testFunction'; };
  bridge.sendMessage = onSendMessage;
  bridge.requestConfig = onRequestConfig;
  if (window.runtime) { bridge.totalMemory = window.runtime.flash.system.System.totalMemory; }
</script>
</head>
<body onload="loadFrame();">
<iframe id="iChild"
    style="position:absolute; left:0; top:0; width:100%; height:100%;"
    frameborder="0" scrolling="auto"
    src="child.html"
    ondominitialize="setupBridge();" >
</iframe>
</body>
</html>